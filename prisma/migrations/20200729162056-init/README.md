# Migration `20200729162056-init`

This migration has been generated by Marc Fouchi at 7/29/2020, 4:20:56 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `showtkt`.`User` (
`companyId` int NOT NULL ,`email` varchar(191) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`name` varchar(191)   ,`password` varchar(191) NOT NULL  ,`roleType` ENUM('SuperAdmin', 'CompanyAdmin', 'Customer') NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `showtkt`.`Company` (
`id` int NOT NULL  AUTO_INCREMENT,`name` varchar(191)   ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `showtkt`.`Event` (
`companyId` int NOT NULL ,`dateTime` datetime(3) NOT NULL  ,`id` int NOT NULL  AUTO_INCREMENT,`maxAdmission` int   ,`name` varchar(191)   ,`productionId` int NOT NULL ,`venueId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `showtkt`.`Producer` (
`companyId` int NOT NULL ,`id` int NOT NULL  AUTO_INCREMENT,`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `showtkt`.`Production` (
`companyId` int NOT NULL ,`id` int NOT NULL  AUTO_INCREMENT,`name` varchar(191) NOT NULL  ,`producerId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `showtkt`.`Venue` (
`id` int NOT NULL  AUTO_INCREMENT,`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `showtkt`.`Seat` (
`eventId` int  ,`id` int NOT NULL  AUTO_INCREMENT,`level` varchar(191)   ,`number` varchar(191)   ,`row` varchar(191)   ,`section` varchar(191)   ,`status` int   ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `showtkt`.`SeatingChart` (
`id` int NOT NULL  AUTO_INCREMENT,`name` varchar(191) NOT NULL  ,`venueId` int  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `showtkt`.`_CompanyToVenue` (
`A` int NOT NULL ,`B` int NOT NULL 
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `User.email` ON `showtkt`.`User`(`email`)

CREATE  INDEX `fk_event_production_idx` ON `showtkt`.`Event`(`productionId`)

CREATE  INDEX `fk_event_company_idx` ON `showtkt`.`Event`(`companyId`)

CREATE  INDEX `fk_event_venue_idx` ON `showtkt`.`Event`(`venueId`)

CREATE  INDEX `fk_producer_company_idx` ON `showtkt`.`Producer`(`companyId`)

CREATE  INDEX `fk_production_company_idx` ON `showtkt`.`Production`(`companyId`)

CREATE  INDEX `fk_production_producer_idx` ON `showtkt`.`Production`(`producerId`)

CREATE  INDEX `fk_seat_event_idx` ON `showtkt`.`Seat`(`eventId`)

CREATE  INDEX `fk_seatingchart_venue_idx` ON `showtkt`.`SeatingChart`(`venueId`)

CREATE UNIQUE INDEX `_CompanyToVenue_AB_unique` ON `showtkt`.`_CompanyToVenue`(`A`,`B`)

CREATE  INDEX `_CompanyToVenue_B_index` ON `showtkt`.`_CompanyToVenue`(`B`)

ALTER TABLE `showtkt`.`User` ADD FOREIGN KEY (`companyId`) REFERENCES `showtkt`.`Company`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `showtkt`.`Event` ADD FOREIGN KEY (`companyId`) REFERENCES `showtkt`.`Company`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `showtkt`.`Event` ADD FOREIGN KEY (`productionId`) REFERENCES `showtkt`.`Production`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `showtkt`.`Event` ADD FOREIGN KEY (`venueId`) REFERENCES `showtkt`.`Venue`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `showtkt`.`Producer` ADD FOREIGN KEY (`companyId`) REFERENCES `showtkt`.`Company`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `showtkt`.`Production` ADD FOREIGN KEY (`companyId`) REFERENCES `showtkt`.`Company`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `showtkt`.`Production` ADD FOREIGN KEY (`producerId`) REFERENCES `showtkt`.`Producer`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `showtkt`.`Seat` ADD FOREIGN KEY (`eventId`) REFERENCES `showtkt`.`Event`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `showtkt`.`SeatingChart` ADD FOREIGN KEY (`venueId`) REFERENCES `showtkt`.`Venue`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `showtkt`.`_CompanyToVenue` ADD FOREIGN KEY (`A`) REFERENCES `showtkt`.`Company`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `showtkt`.`_CompanyToVenue` ADD FOREIGN KEY (`B`) REFERENCES `showtkt`.`Venue`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200729162056-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,105 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+enum RoleType {
+  SuperAdmin
+  CompanyAdmin
+  Customer
+}
+
+model User {
+  id          Int         @default(autoincrement()) @id
+  email       String      @unique
+  password    String
+  name        String?
+  companyId   Int
+  Company     Company     @relation(fields: [companyId], references: [id])
+  roleType    RoleType
+}
+
+model Company {
+  id          Int          @default(autoincrement()) @id
+  name        String?
+  Producers   Producer[]
+  Productions Production[]
+  Events      Event[]
+  Venues      Venue[]      @relation(references: [id])
+}
+
+model Event {
+  id       Int         @default(autoincrement()) @id
+  name          String?
+  maxAdmission  Int?
+  dateTime      DateTime
+  venueId       Int
+  productionId  Int
+  companyId     Int
+  Company       Company    @relation(fields: [companyId], references: [id])
+  Production    Production @relation(fields: [productionId], references: [id])
+  Venue         Venue      @relation(fields: [venueId], references: [id])
+  Seats         Seat[]
+
+  @@index([productionId], name: "fk_event_production_idx")
+  @@index([companyId], name: "fk_event_company_idx")
+  @@index([venueId], name: "fk_event_venue_idx")
+}
+
+model Producer {
+  id          Int          @default(autoincrement()) @id
+  name        String
+  companyId   Int
+  Company     Company      @relation(fields: [companyId], references: [id])
+  Productions Production[]
+
+  @@index([companyId], name: "fk_producer_company_idx")
+}
+
+model Production {
+  id           Int       @default(autoincrement()) @id
+  name         String
+  producerId   Int
+  companyId    Int
+  Company      Company   @relation(fields: [companyId], references: [id])
+  Producer     Producer  @relation(fields: [producerId], references: [id])
+  Events       Event[]
+
+  @@index([companyId], name: "fk_production_company_idx")
+  @@index([producerId], name: "fk_production_producer_idx")
+}
+
+model Venue {
+  id            Int            @default(autoincrement()) @id
+  name          String
+  Events        Event[]
+  SeatingCharts SeatingChart[]
+  Companies     Company[]      @relation(references: [id])
+}
+
+model Seat {
+  id      Int     @default(autoincrement()) @id
+  section String?
+  row     String?
+  number  String?
+  level   String?
+  status  Int?
+  eventId Int?
+  Event   Event?  @relation(fields: [eventId], references: [id])
+
+  @@index([eventId], name: "fk_seat_event_idx")
+}
+
+model SeatingChart {
+  id             Int     @default(autoincrement()) @id
+  name           String
+  venueId        Int?
+  Venue          Venue?  @relation(fields: [venueId], references: [id])
+
+  @@index([venueId], name: "fk_seatingchart_venue_idx")
+}
+
```


